---
title: "Summary of models included in rtedem"
author: "K Todd-Brown (ktoddbrown@gmail.com)"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

There are several soil decomposition models already coded into *rtedem* including: CENTURY, TECO, CLM, and YASSO07.

```{r}
library(ggplot2)
library(plyr)
library(Matrix)
library(rtedem)

codedParameters <- publishedParameters()

minMaxBounds <- makeModelBounds(codedParameters)
```


```{r plotTurnover, fig.width=6}

turnovers <- ldply(names(minMaxBounds), function(xx){
  ans <- minMaxBounds[[xx]][grepl('K', minMaxBounds[[xx]]$name),]
  ans[,c('true', 'min', 'max')] <- ans[,c('true', 'min', 'max')] * -1
  ans$model <- xx
  return(ans)
})
turnovers$modelIndex <- as.numeric(as.factor(turnovers$model))
yAxis <- unique(turnovers[,c('model', 'modelIndex')])
ggplot(turnovers) + geom_rect(aes(ymax=modelIndex+0.45, ymin=modelIndex-0.45, xmax=min/365, xmin=max/365, fill=name)) + 
  geom_point(aes(y=modelIndex, x=true/365)) + 
  scale_x_log10() + scale_y_continuous(breaks=yAxis$modelIndex, labels=yAxis$model) + labs(title='Comparison of turnover times', y='', x='time [yr]') + guides(fill=FALSE)
```

```{r}
decayMatrix <- llply(codedParameters, function(xx){
  Turnover <- Matrix(diag(xx$tau/365))
  A <- matrix(data=0, nrow=dim(Turnover)[1], ncol=dim(Turnover)[2])
  A[as.numeric(gsub('A', '', xx$trans$name))] <- xx$trans$val
  return(list(turnover = Turnover, transfer=Matrix(A), K=Matrix(diag(1/(xx$tau/365)))))
})

l_ply(names(codedParameters), function(xx){
  #cat(xx,' turnover [year]:\n');print(decayMatrix[[xx]]$turnover)
  cat(xx, ' transfer Matrix:\n');print(decayMatrix[[xx]]$transfer)
})

l_ply(names(codedParameters), function(xx){
  cat(xx, 'decay Matrix (1/tau*transfer):\n')
  A <- decayMatrix[[xx]]$transfer
  diag(A) <- -1
  print(decayMatrix[[xx]]$K %*% A)
})
```
